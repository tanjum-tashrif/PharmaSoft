{% extends 'backend/dashboard/main.html' %}
{% load static %}

{% block header_resource %}

<style>
    .card {
        background-color: #fff;
        border-radius: 10px;
        border: none;
        position: relative;
        margin-bottom: 30px;
        box-shadow: 0 0.46875rem 2.1875rem rgba(90, 97, 105, 0.1), 0 0.9375rem 1.40625rem rgba(90, 97, 105, 0.1), 0 0.25rem 0.53125rem rgba(90, 97, 105, 0.12), 0 0.125rem 0.1875rem rgba(90, 97, 105, 0.1);
    }

    .l-bg-cherry {
        background: linear-gradient(to right, #493240, #f09) !important;
        color: #fff;
    }

    .l-bg-blue-dark {
        background: linear-gradient(to right, #373b44, #4286f4) !important;
        color: #fff;
    }

    .l-bg-green-dark {
        background: linear-gradient(to right, #0a504a, #38ef7d) !important;
        color: #fff;
    }

    .l-bg-orange-dark {
        background: linear-gradient(to right, #a86008, #ffba56) !important;
        color: #fff;
    }

    .card .card-statistic-3 .card-icon-large .fas,
    .card .card-statistic-3 .card-icon-large .far,
    .card .card-statistic-3 .card-icon-large .fab,
    .card .card-statistic-3 .card-icon-large .fal {
        font-size: 110px;
    }

    .card .card-statistic-3 .card-icon {
        text-align: center;
        line-height: 50px;
        margin-left: 15px;
        color: #000;
        position: absolute;
        right: 15px;
        top: 20px;
        opacity: 0.1;
    }

    .l-bg-cyan {
        background: linear-gradient(135deg, #289cf5, #84c0ec) !important;
        color: #fff;
    }

    .l-bg-green {
        background: linear-gradient(135deg, #23bdb8 0%, #43e794 100%) !important;
        color: #fff;
    }

    .l-bg-orange {
        background: linear-gradient(to right, #f9900e, #ffba56) !important;
        color: #fff;
    }

    .l-bg-cyan {
        background: linear-gradient(135deg, #289cf5, #84c0ec) !important;
        color: #fff;
    }
</style>

{% endblock %}


{% block content %}

<div class="container">
    <div class="row ">
        <div class="col-xl-6 col-lg-6">
            <div class="card l-bg-cherry">
                <div class="card-statistic-3 p-4">
                    <div class="card-icon card-icon-large"><i class="fas fa-users"></i></div>
                    <div class="mb-4">
                        <h5 class="card-title mb-0" style="color : #fff">Total Supplier</h5>
                    </div>
                    <div class="row align-items-center mb-2 d-flex">
                        <div class="col-8">
                            <h2 class="d-flex align-items-center mb-0" style="color : #fff">
                                {{ tota_suppliers }}
                            </h2>
                        </div>
                        <div class="col-4 text-right">
                            <span style="color : #fff; font-weight: bold;">{{ growth_percentage_supplier }}% <i
                                    class="fa fa-arrow-up"></i></span>
                        </div>
                    </div>
                    <div class="progress mt-1 " data-height="8" style="height: 8px;">
                        <div class="progress-bar l-bg-cyan supplier_bar" role="progressbar"
                            data-width="{{ progress_width_supplier }}" aria-valuenow="{{ progress_width_supplier }}"
                            aria-valuemin="0" aria-valuemax="100">
                        </div>
                        
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-6 col-lg-6">
            <div class="card l-bg-blue-dark">
                <div class="card-statistic-3 p-4">
                    <div class="card-icon card-icon-large"><i class="fas fa-house-medical"></i></div>
                    <div class="mb-4">
                        <h5 class="card-title mb-0" style="color: #fff;">Total Medicine</h5>
                    </div>
                    <div class="row align-items-center mb-2 d-flex">
                        <div class="col-8">
                            <h2 class="d-flex align-items-center mb-0" style="color: #fff;">
                                {{ total_medicines }}
                            </h2>
                        </div>
                        <div class="col-4 text-right">
                            <span style="color: #fff; font-weight: bolder;">{{ growth_percentage_medicine }}% <i
                                class="fa fa-arrow-up"></i></span>
                            </div>
                        </div>
                        <div class="progress mt-1 " data-height="8" style="height: 8px;">
                        <div class="progress-bar l-bg-cyan medicine_bar" role="progressbar"
                            data-width="{{ progress_width_medicine }}" aria-valuenow="{{ progress_width_medicine }}"
                            aria-valuemin="0" aria-valuemax="100">
                        </div>
                       
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-6 col-lg-6">
            <div class="card l-bg-green-dark">
                <div class="card-statistic-3 p-4">
                    <div class="card-icon card-icon-large"><i class="fas fa-ticket-alt"></i></div>
                    <div class="mb-4">
                        <h5 class="card-title mb-0" style="color: #fff;">Total Outoff Stock Medicine</h5>
                    </div>
                    <div class="row align-items-center mb-2 d-flex">
                        <div class="col-8">
                            <h2 class="d-flex align-items-center mb-0" style="color: #fff;">
                                {{ out_of_stock_medicines }}
                            </h2>
                        </div>
                        <div class="col-4 text-right">
                            <!-- <button style="color: #fff;">Add Medicine <i class="fa fa-arrow-up"></i></button> -->
                        </div>
                    </div>
                    <div class="progress mt-1 " data-height="8" style="height: 8px;">
                        <div class="progress-bar l-bg-orange" role="progressbar" data-width="25%" aria-valuenow="25"
                            aria-valuemin="0" aria-valuemax="100" style="width: 100%;"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-xl-6 col-lg-6">
            <div class="card l-bg-orange-dark">
                <div class="card-statistic-3 p-4">
                    <div class="card-icon card-icon-large"><i class="fas fa-prescription-bottle-medical"></i></div>
                    <div class="mb-4">
                        <h5 class="card-title mb-0" style="color: #fff;">Total Expired Medicine</h5>
                    </div>
                    <div class="row align-items-center mb-2 d-flex">
                        <div class="col-8">
                            <h2 class="d-flex align-items-center mb-0" style="color: #fff;">
                                {{ expired_medicines }}
                            </h2>
                        </div>
                        <!-- <div class="col-4 text-right">
                            <span style="color: #fff;">2.5% <i class="fa fa-arrow-up"></i></span>
                        </div> -->
                    </div>
                    <div class="progress mt-1 " data-height="8" style="height: 8px;">
                        <div class="progress-bar l-bg-cyan" role="progressbar" data-width="25%" aria-valuenow="25"
                            aria-valuemin="0" aria-valuemax="100" style="width: 100%;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

     <!--  New PPPoe and Hotspot Customer graph start -->
     <div class="col-xl-12 col-md-12">
        <div class="card table-card">
            <div class="card-header">
                <h5>New Medicine Added List Graph</h5>
                
            </div>
            <div class="card-block">
                <div class="table-responsive">
                    <!-- graph  -->
                    <div id="loader1" class="load"
                        style="width: 100%; height: 400px; display: flex; justify-content: center; align-items: center;">
                        <div id="loader"
                            style="display: inline-block; width: 125px; height: 125px; border: 16px solid rgba(0, 0, 0, 0.1); border-top: 16px solid #3498db; border-radius: 50%; animation: spin 2s linear infinite; vertical-align: middle;">
                        </div>
                    </div>
                    <div id="graph"
                        style="width: 1000px;  height: 400px; left: 26px; top: 10px; margin: 6px; display: none;">
                    </div>

                </div>
            </div>
        </div>
    </div>
    <!--  New PPPoe and Hotspot Customer graph end -->
</div>

{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/echarts/dist/echarts.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        const progressBar = document.querySelector('.supplier_bar');
        const width = progressBar.getAttribute('data-width');
        progressBar.style.width = width + '%';
    });

    document.addEventListener("DOMContentLoaded", function () {
        const progressBar = document.querySelector('.medicine_bar');
        const width = progressBar.getAttribute('data-width');
        progressBar.style.width = width + '%';
    });

    

</script>

<script>
// Get the chart DOM element
var chartDom = document.getElementById('graph');
var myChart = echarts.init(chartDom);

// Function to hide loader and show chart
function showChart() {
    document.getElementById('loader1').style.display = 'none';
    document.getElementById('graph').style.display = 'block';
}

// Fetch data from the single URL and render the chart
$.ajax({
    url: '/medicine_monthly_chart/',
    method: 'GET',
    dataType: 'json',
    success: function (response) {
        var months = response.keys;
        var medicineCounts = response.values;

        // Prepare data for ECharts dataset
        var dataset = [];
        dataset.push(['Month', 'Medicines Created']);
        for (var i = 0; i < months.length; i++) {
            dataset.push([months[i], medicineCounts[i]]);
        }

        // Configure ECharts options
        var option = {
            legend: {},
            tooltip: {},
            dataset: {
                source: dataset
            },
            xAxis: {
                type: 'category',
                axisLabel: {
                    interval: 0,  // Show all labels
                    rotate: 45,   // Rotate labels for better visibility
                    fontSize: 10
                }
            },
            yAxis: {},
            series: [
                {
                    type: 'bar',
                    name: 'Medicines Created',
                    barWidth: '80%',  // Adjust bar width
                    label: {
                        show: true,  // Show values on top
                        position: 'top'
                    }
                }
            ]
        };

        // Set the option to the chart
        myChart.setOption(option);
        showChart();

        // Handle window resize
        window.addEventListener('resize', function () {
            myChart.resize();
        });
    },
    error: function (error) {
        console.error("Failed to fetch medicine data", error);
    }
});

</script>

{% endblock extra_js %}